<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A4 Photo Printer + Shipping Label</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        label {
          font-family: Helvetica, Arial, sans-serif !important;
        }
    html, body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Sarabun', sans-serif;
    }
    
    @media print {
      html, body {
        width: 210mm !important;
        height: 297mm !important;
        margin: 0 !important;
        padding: 0 !important;
        background: white !important;
        overflow: hidden !important;
      }
      .no-print {
        display: none !important;
      }
      .print-area {
        width: 210mm !important;
        height: 297mm !important;
        margin: 0 auto !important;
        padding: 0 !important;
        box-shadow: none !important;
        border: none !important;
        background: white !important;
        display: flex !important;
        flex-direction: column !important;
        position: relative !important;
        overflow: hidden !important;
        page-break-after: avoid !important;
        page-break-before: avoid !important;
        page-break-inside: avoid !important;
      }
      .top-image-section, .bottom-section, .small-image-section, .text-section {
        box-shadow: none !important;
        border: none !important;
        background: none !important;
        margin: 0 !important;
        padding: 0 !important;
        page-break-after: avoid !important;
        page-break-before: avoid !important;
        page-break-inside: avoid !important;
      }
      .print-image {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
        max-height: 100% !important;
        max-width: 100% !important;
      }
      @page {
        size: A4;
        margin: 0;
      }
    }
    
    .upload-zone {
      border: 3px dashed #cbd5e1;
      transition: all 0.3s ease;
    }
    
    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: #6366f1;
      background: #eef2ff;
    }

    .top-image-section {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #f9fafb;
    }

    .bottom-section {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      border-top: 1px solid #e5e7eb;
    }

    .small-image-section {
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #f9fafb;
      flex: 1;
      min-width: 0;
      min-height: 0;
      border-right: 1px solid #e5e7eb;
      border-bottom: 1px solid #e5e7eb;
    }

    .small-image-section:nth-child(3n) {
      border-right: none;
    }

    .text-section {
      flex: 0 0 auto;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      min-height: auto;
      background: white;
    }

    .text-section p {
      margin: 0;
      word-wrap: break-word;
      word-break: break-word;
      font-size: 1.2rem;
      padding: 0;
    }

    .fit-contain {
      object-fit: contain;
    }
    
    .fit-cover {
      object-fit: cover;
    }

    .link-input {
      font-size: 0.875rem;
      padding: 0.5rem;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.5rem;
    }

    .gallery-item {
      position: relative;
      overflow: hidden;
      border-radius: 0.5rem;
      background: white;
    }

    .gallery-item img {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }

    .delete-btn {
      position: absolute;
      top: 2px;
      right: 2px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .gallery-item:hover .delete-btn {
      opacity: 1;
    }

    .delete-btn:hover {
      background: rgba(220, 38, 38, 1);
    }

    .print-area {
      width: 210mm;
      height: 297mm;
      padding: 0.2in;
      background: white;
      display: flex;
      flex-direction: column;
      border: 1px dashed #999;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-slate-100 via-indigo-50 to-purple-50">
  <div class="h-full w-full overflow-auto"><!-- Control Panel -->
   <div class="no-print sticky top-0 z-10 bg-white/90 backdrop-blur-sm shadow-md">
    <div class="max-w-6xl mx-auto px-4 py-4">
     <div class="flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
        </svg>
       </div>
       <div>
        <h1 class="text-xl font-bold text-gray-800">‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ Shopee/Lazada/Tiktok</h1>
        <p class="text-sm text-gray-500">‡πÇ‡∏•‡πÇ‡∏Å‡πâ + ‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å + ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</p>
       </div>
      </div>
      <div class="flex flex-wrap items-center gap-3"><!-- Fit Mode -->
       <div class="flex items-center gap-2 bg-gray-100 rounded-lg p-1">
         <button id="fit-contain" class="fit-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all bg-white shadow text-indigo-600" data-mode="contain"> ‡∏û‡∏≠‡∏î‡∏µ </button>
         <button id="fit-cover" class="fit-btn px-3 py-1.5 rounded-md text-sm font-medium transition-all text-gray-600 hover:bg-white/50" data-mode="cover"> ‡πÄ‡∏ï‡πá‡∏° </button>
       </div>
       <!-- Print Button A4 -->
       <button id="print-btn" class="flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-5 py-2.5 rounded-xl font-semibold shadow-lg hover:shadow-xl hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
         </svg> ‡∏û‡∏¥‡∏°‡∏û‡πå A4
       </button>
       <!-- Shipping Label Button -->
       <button id="shipping-label-btn" class="flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-5 py-2.5 rounded-xl font-semibold shadow-lg hover:shadow-xl hover:scale-105 transition-all">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
         </svg> ‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
       </button>
      </div>
     </div>
    </div>
   </div><!-- Main Content -->
   <div class="max-w-6xl mx-auto px-4 py-8"><!-- Text Input -->
    <div class="no-print mb-6 bg-white rounded-xl p-4 shadow-sm"><label class="block text-sm font-semibold text-gray-700 mb-2">üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ / ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label> <textarea id="manual-text-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ A4 (‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢)" rows="2" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-indigo-500 focus:outline-none transition-colors"></textarea>
    </div><!-- Upload Zones -->
    <div class="no-print space-y-4 mb-8"><!-- Image 1 Upload (Logo) -->
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">üì∏ ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1 (‡πÇ‡∏•‡πÇ‡∏Å‡πâ / ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ö‡∏ô A4)</label>
      <div id="upload-zone-1" class="upload-zone rounded-xl p-6 text-center cursor-pointer bg-white/50"><input type="file" id="file-input-1" accept="image/*" class="hidden">
       <div class="flex flex-col items-center gap-2">
        <svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p class="text-sm font-medium text-gray-700">‡∏Ñ‡∏•‡∏¥‡∏Å / ‡∏•‡∏≤‡∏Å / Paste</p>
        <p class="text-xs text-gray-500">‡∏£‡∏π‡∏õ Link ‡∏ß‡∏≤‡∏á‡πÑ‡∏î‡πâ</p>
       </div>
      </div>
      <div id="preview-thumb-1" class="hidden mt-2 rounded-lg overflow-hidden border-2 border-indigo-300"><img id="preview-image-thumb-1" class="w-full h-24 object-cover">
      </div><input type="text" id="link-input-1" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á Link ‡∏£‡∏π‡∏õ" class="link-input mt-2 w-full border rounded-lg">
     </div><!-- Images 2+ Upload -->
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">üì∏ ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2+ (‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏•‡πà‡∏≤‡∏á A4 - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ)</label>
      <div id="upload-zone-multi" class="upload-zone rounded-xl p-6 text-center cursor-pointer bg-white/50"><input type="file" id="file-input-multi" accept="image/*" multiple class="hidden">
       <div class="flex flex-col items-center gap-2">
        <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p class="text-sm font-medium text-gray-700">‡∏Ñ‡∏•‡∏¥‡∏Å / ‡∏•‡∏≤‡∏Å / Paste</p>
        <p class="text-xs text-gray-500">‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ</p>
       </div>
      </div>
      <div id="gallery-container" class="mt-4 gallery-grid"></div>
      <div id="link-input-multi-container" class="mt-2 space-y-2"><input type="text" id="link-input-multi" placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á Link ‡∏£‡∏π‡∏õ (‡∏Å‡∏î Enter)" class="link-input w-full border rounded-lg">
      </div>
     </div>
    </div><!-- A4 Preview -->
    <div id="preview-container" class="flex justify-center mb-8">
     <div id="a4-preview" class="print-area bg-white shadow-2xl rounded-lg"><!-- Image 1 Section (Top 50%) -->
      <div class="top-image-section">
       <div id="empty-state-1" class="text-center text-gray-400">
        <svg class="w-16 h-16 mx-auto mb-2 opacity-30" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p class="text-xs">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1</p>
       </div><img id="preview-image-1" class="print-image hidden fit-contain" alt="Image 1">
      </div><!-- Images 2+ Section (Bottom 50%, 3 columns) -->
      <div id="bottom-section" class="bottom-section"><!-- Will be filled with preview images -->
      </div><!-- Text Section -->
      <div class="text-section">
       <div id="empty-state-text" class="text-gray-300 text-xs px-2">
        <p>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤</p>
       </div>
       <p id="footer-text" class="hidden text-gray-800 px-2 text-sm"></p>
      </div>
     </div>
    </div>
   </div><!-- Footer -->
   <div class="no-print text-center py-6 text-gray-500 text-sm">
    <p>üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏ß‡∏≤‡∏á Screenshot ‡∏´‡∏£‡∏∑‡∏≠ Link ‡∏£‡∏π‡∏õ ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏£‡πâ‡∏Ç‡∏≠‡∏ö"</p>
   </div>
  </div>
  <script>
    const defaultConfig = {
      footer_text: '',
      primary_color: '#6366f1',
      secondary_color: '#ffffff',
      text_color: '#1f2937',
      accent_color: '#8b5cf6',
      border_color: '#e2e8f0'
    };
    
    let config = { ...defaultConfig };
    let fitMode = 'contain';
    let image1 = null;
    let multiImages = [];
    let footerTextValue = '';
    
    // DOM Elements
    const uploadZone1 = document.getElementById('upload-zone-1');
    const uploadZoneMulti = document.getElementById('upload-zone-multi');
    const fileInput1 = document.getElementById('file-input-1');
    const fileInputMulti = document.getElementById('file-input-multi');
    const linkInput1 = document.getElementById('link-input-1');
    const linkInputMulti = document.getElementById('link-input-multi');
    const previewImage1 = document.getElementById('preview-image-1');
    const previewThumb1 = document.getElementById('preview-thumb-1');
    const previewImageThumb1 = document.getElementById('preview-image-thumb-1');
    const emptyState1 = document.getElementById('empty-state-1');
    const emptyStateText = document.getElementById('empty-state-text');
    const footerText = document.getElementById('footer-text');
    const printBtn = document.getElementById('print-btn');
    const shippingLabelBtn = document.getElementById('shipping-label-btn');
    const fitBtns = document.querySelectorAll('.fit-btn');
    const manualTextInput = document.getElementById('manual-text-input');
    const galleryContainer = document.getElementById('gallery-container');
    const bottomSection = document.getElementById('bottom-section');

    // Upload handlers - Image 1
        // Paste image from clipboard for ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1
        uploadZone1.addEventListener('paste', (e) => {
          const items = e.clipboardData.items;
          for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
              const file = items[i].getAsFile();
              const reader = new FileReader();
              reader.onload = (event) => {
                image1 = event.target.result;
                previewImage1.src = image1;
                previewImage1.classList.remove('hidden');
                emptyState1.classList.add('hidden');
                previewImageThumb1.src = image1;
                previewThumb1.classList.remove('hidden');
                updatePrintBtn();
              };
              reader.readAsDataURL(file);
              break;
            }
          }
        });
    uploadZone1.addEventListener('click', () => fileInput1.click());
    uploadZone1.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone1.classList.add('dragover');
    });
    uploadZone1.addEventListener('dragleave', () => {
      uploadZone1.classList.remove('dragover');
    });
    uploadZone1.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone1.classList.remove('dragover');
      handleFile1(e.dataTransfer.files[0]);
    });
    fileInput1.addEventListener('change', (e) => {
      if (e.target.files[0]) {
        handleFile1(e.target.files[0]);
      }
    });

    // Upload handlers - Multiple Images
    uploadZoneMulti.addEventListener('click', () => fileInputMulti.click());
    uploadZoneMulti.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZoneMulti.classList.add('dragover');
    });
    uploadZoneMulti.addEventListener('dragleave', () => {
      uploadZoneMulti.classList.remove('dragover');
    });
    uploadZoneMulti.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZoneMulti.classList.remove('dragover');
      handleMultipleFiles(e.dataTransfer.files);
    });
    fileInputMulti.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleMultipleFiles(e.target.files);
      }
    });

    linkInput1.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const url = linkInput1.value.trim();
        if (url.startsWith('http')) {
          loadImageFromLink(url, 1);
        }
      }
    });

    linkInputMulti.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const url = linkInputMulti.value.trim();
        if (url.startsWith('http')) {
          loadImageFromLink(url, 0);
          linkInputMulti.value = '';
        }
      }
    });

    function loadImageFromLink(url, position) {
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        const dataUrl = canvas.toDataURL('image/jpeg');
        
        if (position === 1) {
          image1 = dataUrl;
          previewImage1.src = image1;
          previewImage1.classList.remove('hidden');
          emptyState1.classList.add('hidden');
          previewImageThumb1.src = image1;
          previewThumb1.classList.remove('hidden');
        } else {
          addMultiImage(dataUrl);
        }
        updatePrintBtn();
      };
      img.onerror = () => {
        console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ:', url);
      };
      img.src = url;
    }
    
    function handleFile1(file) {
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          image1 = e.target.result;
          previewImage1.src = image1;
          previewImage1.classList.remove('hidden');
          emptyState1.classList.add('hidden');
          previewImageThumb1.src = image1;
          previewThumb1.classList.remove('hidden');
          updatePrintBtn();
        };
        reader.readAsDataURL(file);
      }
    }

    function handleMultipleFiles(files) {
      Array.from(files).forEach(file => {
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            addMultiImage(e.target.result);
            updatePrintBtn();
          };
          reader.readAsDataURL(file);
        }
      });
    }

    function addMultiImage(imageData) {
      const id = 'img-' + Date.now() + Math.random();
      multiImages.push({ id, src: imageData });
      renderGallery();
      updatePreview();
    }

    function removeMultiImage(id) {
      multiImages = multiImages.filter(img => img.id !== id);
      renderGallery();
      updatePreview();
      updatePrintBtn();
    }

    function renderGallery() {
      galleryContainer.innerHTML = multiImages.map(img => `
        <div class="gallery-item">
          <img src="${img.src}" alt="gallery image">
          <button class="delete-btn" onclick="removeMultiImage('${img.id}')" title="‡∏•‡∏ö">‚úï</button>
        </div>
      `).join('');
    }

    function updatePreview() {
      bottomSection.innerHTML = '';

      if (multiImages.length === 0) {
        bottomSection.innerHTML = `
          <div class="small-image-section" style="flex: 1;">
            <div class="text-center text-gray-400">
              <svg class="w-12 h-12 mx-auto mb-2 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <p class="text-xs">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2+</p>
            </div>
          </div>
        `;
      } else {
        multiImages.forEach((img, idx) => {
          const section = document.createElement('div');
          section.className = 'small-image-section';
          section.style.flex = '1';
          section.innerHTML = `<img src="${img.src}" class="print-image fit-${fitMode}" alt="Image ${idx + 2}">`;
          bottomSection.appendChild(section);
        });
      }
    }

    function updatePrintBtn() {
      printBtn.disabled = !image1 || multiImages.length === 0;
    }
    
    fitBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        fitMode = btn.dataset.mode;
        updateFitMode();
      });
    });
    
    function updateFitMode() {
      fitBtns.forEach(btn => {
        if (btn.dataset.mode === fitMode) {
          btn.classList.add('bg-white', 'shadow', 'text-indigo-600');
          btn.classList.remove('text-gray-600');
        } else {
          btn.classList.remove('bg-white', 'shadow', 'text-indigo-600');
          btn.classList.add('text-gray-600');
        }
      });
      
      previewImage1.classList.remove('fit-contain', 'fit-cover');
      previewImage1.classList.add(`fit-${fitMode}`);

      document.querySelectorAll('#bottom-section .print-image').forEach(img => {
        img.classList.remove('fit-contain', 'fit-cover');
        img.classList.add(`fit-${fitMode}`);
      });
    }
    
    printBtn.addEventListener('click', () => {
      window.print();
    });

    shippingLabelBtn.addEventListener('click', () => {
      const address = footerTextValue || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà';
      const newWin = window.open('', 'ShippingLabel', 'width=600,height=750');
      newWin.document.write(createShippingLabelHTML(address));
      newWin.document.close();
    });

    function createShippingLabelHTML(address) {
      return `
        <!DOCTYPE html>
        <html lang="th">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏±‡∏î‡∏™‡πà‡∏á 4x6</title>
          <style>
            * {
              font-family: Helvetica, Arial, sans-serif;
              box-sizing: border-box;
            }
            body {
              margin: 0;
              padding: 1rem;
              background: white;
            }
            @media print {
              .no-print {
                display: none !important;
              }
              body {
                padding: 0;
              }
              @page {
                size: 4in 6in;
                margin: 0;
              }
              .slip-area {
                width: 4in !important;
                height: 6in !important;
                padding: 0.15in !important;
                margin: 0 !important;
              }
            }
            .no-print {
              background: white;
              padding: 1rem;
              border-bottom: 2px solid #ddd;
              display: flex;
              gap: 0.5rem;
              margin-bottom: 1rem;
              flex-wrap: wrap;
            }
            .no-print button {
              background: #6366f1;
              color: white;
              border: none;
              padding: 0.7rem 1.2rem;
              border-radius: 0.5rem;
              cursor: pointer;
              font-family: Helvetica, Arial, sans-serif;
              font-size: 1rem;
              font-weight: 500;
              transition: background 0.2s;
            }
            .no-print button:hover {
              background: #4f46e5;
            }
            .content-wrapper {
              display: flex;
              justify-content: center;
            }
            .slip-area {
              width: 4in;
              height: 6in;
              padding: 0.15in;
              background: white;
              display: flex;
              flex-direction: column;
              gap: 0.06in;
              font-size: 10pt;
              line-height: 1.2;
              border: 2px solid #000;
              page-break-after: always;
              font-family: Helvetica, Arial, sans-serif;
            }
            .slip-header {
              text-align: center;
              font-weight: bold;
              font-size: 13pt;
              margin-bottom: 0.08in;
              border-bottom: 2px solid #000;
              padding-bottom: 0.05in;
            }
            .sender-section {
              background: #f5f5f5;
              border: 1px solid #ddd;
              padding: 0.08in;
              margin-bottom: 0.08in;
              display: flex;
              gap: 0.08in;
              align-items: flex-start;
            }
            .sender-logo {
              width: 0.6in;
              height: 0.6in;
              background: white;
              border: 1px solid #ccc;
              border-radius: 0.05in;
              display: flex;
              align-items: center;
              justify-content: center;
              flex-shrink: 0;
              overflow: hidden;
            }
            .sender-logo img {
              width: 100%;
              height: 100%;
              object-fit: contain;
            }
            .sender-info {
              flex: 1;
              min-width: 0;
            }
            .sender-name {
              font-weight: bold;
              font-size: 9pt;
              margin: 0;
              word-break: break-word;
            }
            .sender-detail {
              font-size: 7.5pt;
              margin: 0.02in 0 0 0;
              color: #555;
              word-break: break-word;
              line-height: 1.1;
            }
            .recipient-section {
              flex: 1;
              display: flex;
              flex-direction: column;
              border: 2px solid #000;
              padding: 0.1in;
              background: white;
            }
            .recipient-label {
              font-weight: bold;
              font-size: 8pt;
              margin: 0 0 0.04in 0;
            }
            .recipient-content {
              flex: 1;
              font-size: 10pt;
              margin: 0;
              word-wrap: break-word;
              word-break: break-word;
              overflow: hidden;
            }
            .footer-section {
              display: flex;
              justify-content: space-between;
              padding-top: 0.05in;
              border-top: 1px solid #ddd;
              font-size: 8pt;
            }
            .footer-item {
              margin: 0;
            }
          </style>
        </head>
        <body>
          <div class="no-print">
            <button onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å</button>
            <button onclick="window.close()">‚úï ‡∏õ‡∏¥‡∏î</button>
          </div>
          
          <div class="content-wrapper">
            <div class="slip-area">
              <div class="slip-header" style="font-size: 42px;">‡πÉ‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
              <!-- Sender Section -->
              <div class="sender-section">
                <div class="sender-logo">
                  <img src="https://mms.img.susercontent.com/th-11134216-7ras8-m6i01ncx41rrab" alt="logo" loading="lazy" onerror="console.error('Image failed to load:', this.src); this.style.background='#10b981'; this.alt='Logo unavailable';">
                </div>
                <div class="sender-info">
		  <b style="font-size: 20px;">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</b>
                  <p class="sender-name" style="font-size: 18px;">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏ü‡∏£‡∏ä‡∏°‡∏¥‡∏•‡∏Ñ‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î</p>
                  <p class="sender-detail" style="font-size: 16px;">57/1 ‡∏°.6 ‡∏ï.‡∏ó‡πà‡∏≤‡∏ß‡∏±‡∏á‡∏ï‡∏≤‡∏• ‡∏™‡∏≤‡∏£‡∏†‡∏µ ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</p>
                  <p class="sender-detail" style="font-size: 16px;">‡πÇ‡∏ó‡∏£. 089-6354687</p>
                </div>
              </div>

              <!-- Recipient Section -->
              <div class="recipient-section">
                <p class="recipient-label" style="font-size: 20px;">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö :</p>
                <p class="recipient-content">${address.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p>
		<img src="https://img5.pic.in.th/file/secure-sv1/dont.png" alt="My picture">
              </div>

              <!-- Footer -->
              <div class="footer-section">
                <p class="footer-item">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: '2-digit' })}</p>
                <p class="footer-item">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: _______</p>
              </div>
            </div>
          </div>
        </body>
        </html>
      `;
    }
    
    manualTextInput.addEventListener('input', (e) => {
      footerTextValue = e.target.value.trim();
      if (footerTextValue) {
        footerText.textContent = footerTextValue;
        footerText.classList.remove('hidden');
        emptyStateText.classList.add('hidden');
        
        const maxLength = 80;
        if (footerTextValue.length > maxLength) {
          const ratio = maxLength / footerTextValue.length;
          const newSize = Math.max(0.7, 1.2 * ratio);
          footerText.style.fontSize = newSize + 'rem';
        } else {
          footerText.style.fontSize = '1.2rem';
        }
      } else {
        footerText.classList.add('hidden');
        emptyStateText.classList.remove('hidden');
        footerText.style.fontSize = '1.2rem';
      }
    });
    
    async function onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      
      if (config.footer_text) {
        const textElement = document.getElementById('footer-text');
        footerTextValue = config.footer_text;
        textElement.textContent = config.footer_text;
        textElement.classList.remove('hidden');
        emptyStateText.classList.add('hidden');
        manualTextInput.value = config.footer_text;
        
        const maxLength = 80;
        if (config.footer_text.length > maxLength) {
          const ratio = maxLength / config.footer_text.length;
          const newSize = Math.max(0.7, 1.2 * ratio);
          textElement.style.fontSize = newSize + 'rem';
        } else {
          textElement.style.fontSize = '1.2rem';
        }
      } else {
        document.getElementById('footer-text').classList.add('hidden');
        emptyStateText.classList.remove('hidden');
        document.getElementById('footer-text').style.fontSize = '1.2rem';
      }
    }
    
    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.primary_color || defaultConfig.primary_color,
            set: (value) => {
              cfg.primary_color = value;
              window.elementSdk.setConfig({ primary_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(cfg) {
      return new Map([
        ['footer_text', cfg.footer_text || defaultConfig.footer_text]
      ]);
    }
    
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
    
    updateFitMode();
    updatePreview();
    updatePrintBtn();

    window.removeMultiImage = removeMultiImage;
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c67036b13ffd016',t:'MTc2OTgzOTQ4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>