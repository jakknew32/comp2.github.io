<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Print & Shipping Label - Chiangmai Freshmilk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        .upload-section {
            margin-bottom: 20px;
        }

        .upload-label {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .upload-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #photoInput {
            display: none;
        }

        .photos-per-row {
            margin-bottom: 20px;
        }

        .photos-per-row label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .photos-per-row input,
        .photos-per-row textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .url-input-section {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .url-input-section input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .url-input-section button {
            flex: none;
            min-width: 120px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 150px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-print {
            background: #10b981;
            color: white;
        }

        .btn-print:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-clear {
            background: #ef4444;
            color: white;
        }

        .btn-clear:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .print-area {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .a4-page {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto 20mm;
            background: white;
            padding: 0;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            page-break-after: always;
        }

        .photo-row {
            display: flex;
            gap: 1mm;
            margin-bottom: 1mm;
            justify-content: center;
        }

        .photo-container {
            position: relative;
            flex: 1;
            max-width: 210mm;
            height: calc((297mm - 8mm) / 2.5);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9fafb;
        }

        .photo-container.full-width {
            max-width: 100%;
            height: calc(((297mm - 8mm) / 2.5) * 1.4);
            cursor: pointer;
            border: 2px dashed #ccc;
        }

        .photo-container.full-width.drag-over {
            background: #e0e7ff;
            border-color: #667eea;
        }

        .photo-container.full-width .photo-placeholder {
            pointer-events: none;
        }

        .photo-container.full-width img {
            border: none;
        }

        .photo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-container.full-width img {
            object-fit: contain;
        }

        .photo-placeholder {
            color: #9ca3af;
            font-size: 14px;
        }

        .page-text {
            margin-top: 2mm;
            padding: 2mm;
            text-align: center;
            font-size: 12px;
            color: #333;
            border-top: 1px solid #e0e0e0;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                max-width: 100%;
            }

            h1 {
                display: none;
            }

            .controls {
                display: none;
            }

            .print-area {
                padding: 0;
                box-shadow: none;
            }

            .a4-page {
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 0;
                box-shadow: none;
                page-break-after: always;
            }

            .a4-page:last-child {
                page-break-after: auto;
            }

            .photo-container {
                border: none;
                background: transparent;
            }

            .photo-container.full-width {
                border: none;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .a4-page {
                width: 100%;
                min-height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Photo Print & Shipping Label</h1>
        
        <div class="controls">
            <div class="upload-section">
                <label class="upload-label" for="photoInput">
                    üìÅ Upload Photos (Row 1: Drop or Click)
                </label>
                <input type="file" id="photoInput" accept="image/*" multiple>
            </div>

            <div class="url-input-section">
                <input type="text" id="imageUrl" placeholder="Enter image URL for row 2">
                <button onclick="addImageFromUrl()" style="background: #3b82f6; color: white;">Add from URL</button>
            </div>

            <div class="photos-per-row">
                <label for="photosPerRow">Photos in row 2:</label>
                <input type="number" id="photosPerRow" min="1" max="6" value="3">
            </div>

            <div class="photos-per-row">
                <label for="pageText">Text below page:</label>
                <input type="text" id="pageText" placeholder="Enter text to display below photos">
            </div>

            <div class="button-group">
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print</button>
                <button class="btn-clear" onclick="clearPhotos()">üóëÔ∏è Clear All</button>
                <button onclick="createShippingLabel()" style="background: #f59e0b; color: white;">üì¶ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏Å</button>
            </div>
        </div>

        <div class="print-area" id="printArea">
            <!-- Pages will be generated here -->
        </div>
    </div>

    <script>
        let row1Photo = null;
        let row2Photos = [];
        let photosPerRow = 3;
        let pageText = '';

        document.getElementById('photoInput').addEventListener('change', handleFileSelect);
        document.getElementById('photosPerRow').addEventListener('change', function() {
            photosPerRow = parseInt(this.value);
            renderPhotos();
        });
        document.getElementById('pageText').addEventListener('input', function() {
            pageText = this.value;
            renderPhotos();
        });

        // Drag and drop for row 1
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop();
            setupPaste();
        });

        function setupDragAndDrop() {
            document.addEventListener('dragover', function(e) {
                e.preventDefault();
                const target = e.target.closest('.photo-container.full-width');
                if (target) {
                    target.classList.add('drag-over');
                }
            });

            document.addEventListener('dragleave', function(e) {
                const target = e.target.closest('.photo-container.full-width');
                if (target) {
                    target.classList.remove('drag-over');
                }
            });

            document.addEventListener('drop', function(e) {
                e.preventDefault();
                const target = e.target.closest('.photo-container.full-width');
                if (target) {
                    target.classList.remove('drag-over');
                    
                    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                        const file = e.dataTransfer.files[0];
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                row1Photo = event.target.result;
                                renderPhotos();
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                }
            });
        }

        function setupPaste() {
            document.addEventListener('paste', function(e) {
                const items = e.clipboardData.items;
                for (let item of items) {
                    if (item.type.indexOf('image') !== -1) {
                        const blob = item.getAsFile();
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            row1Photo = event.target.result;
                            renderPhotos();
                        };
                        reader.readAsDataURL(blob);
                        break;
                    }
                }
            });
        }

        function addImageFromUrl() {
            const url = document.getElementById('imageUrl').value.trim();
            if (url) {
                row2Photos.push(url);
                document.getElementById('imageUrl').value = '';
                renderPhotos();
            }
        }

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        row2Photos.push(e.target.result);
                        renderPhotos();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function renderPhotos() {
            const printArea = document.getElementById('printArea');
            printArea.innerHTML = '';

            const totalPages = Math.max(1, Math.ceil(row2Photos.length / photosPerRow));

            for (let pageNum = 0; pageNum < totalPages; pageNum++) {
                const page = createPage();
                const startIdx = pageNum * photosPerRow;
                const endIdx = Math.min(startIdx + photosPerRow, row2Photos.length);

                // Row 1: Single full-width photo with drag/drop support
                const row1 = document.createElement('div');
                row1.className = 'photo-row';
                
                const photo1Container = document.createElement('div');
                photo1Container.className = 'photo-container full-width';
                
                if (row1Photo) {
                    const img = document.createElement('img');
                    img.src = row1Photo;
                    photo1Container.appendChild(img);
                } else {
                    const placeholder = document.createElement('div');
                    placeholder.className = 'photo-placeholder';
                    placeholder.innerHTML = 'Drop image, Paste (Ctrl+V), or Click to upload';
                    photo1Container.appendChild(placeholder);
                }
                
                // Click to upload for row 1
                photo1Container.addEventListener('click', function() {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                row1Photo = event.target.result;
                                renderPhotos();
                            };
                            reader.readAsDataURL(file);
                        }
                    };
                    input.click();
                });
                
                row1.appendChild(photo1Container);
                page.appendChild(row1);

                // Row 2: Multiple photos based on photosPerRow
                const row2 = document.createElement('div');
                row2.className = 'photo-row';

                for (let i = 0; i < photosPerRow; i++) {
                    const photoIdx = startIdx + i;
                    const photoContainer = document.createElement('div');
                    photoContainer.className = 'photo-container';

                    if (photoIdx < endIdx) {
                        const img = document.createElement('img');
                        img.src = row2Photos[photoIdx];
                        photoContainer.appendChild(img);
                    } else {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'photo-placeholder';
                        placeholder.textContent = 'Empty';
                        photoContainer.appendChild(placeholder);
                    }

                    row2.appendChild(photoContainer);
                }

                page.appendChild(row2);

                // Add text below page if provided
                if (pageText.trim() !== '') {
                    const textDiv = document.createElement('div');
                    textDiv.className = 'page-text';
                    textDiv.textContent = pageText;
                    page.appendChild(textDiv);
                }

                printArea.appendChild(page);
            }
        }

        function createPage() {
            const page = document.createElement('div');
            page.className = 'a4-page';
            return page;
        }

        function clearPhotos() {
            row1Photo = null;
            row2Photos = [];
            document.getElementById('photoInput').value = '';
            document.getElementById('imageUrl').value = '';
            renderPhotos();
        }

        function createShippingLabel() {
            const address = document.getElementById('pageText').value.trim();
            showShippingLabelModal(address);
        }

        function showShippingLabelModal(receiverAddress) {
            // Remove existing modal if any
            const existingModal = document.getElementById('shippingLabelModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Create modal overlay
            const modal = document.createElement('div');
            modal.id = 'shippingLabelModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const defaultSender = `‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏ü‡∏£‡∏ä‡∏°‡∏¥‡∏•‡∏Ñ‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î 57/1 ‡∏°.6 ‡∏ï.‡∏ó‡πà‡∏≤‡∏ß‡∏±‡∏á‡∏ï‡∏≤‡∏• ‡∏™‡∏≤‡∏£‡∏†‡∏µ ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÇ‡∏ó‡∏£. 089-6354687`;
            let displayReceiver = receiverAddress || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö';
            if (receiverAddress && !receiverAddress.startsWith('‡∏Ñ‡∏∏‡∏ì')) {
                displayReceiver = '‡∏Ñ‡∏∏‡∏ì ' + receiverAddress;
            }

            const now = new Date();
            const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', 
                               '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            const day = now.getDate();
            const month = thaiMonths[now.getMonth()];
            const year = now.getFullYear() + 543;
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const timestamp = `‡∏û‡∏¥‡∏°‡∏û‡πå: ${day} ${month} ${year} ‡πÄ‡∏ß‡∏•‡∏≤ ${hours}:${minutes} ‡∏ô. | Chiangmai Freshmilk`;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; color: #333; font-family: 'Sarabun', sans-serif;">üì¶ ‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                        <button onclick="closeShippingLabelModal()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-family: 'Sarabun', sans-serif;">‚úï ‡∏õ‡∏¥‡∏î</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333; font-family: 'Sarabun', sans-serif;">üì• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</label>
                        <textarea id="modalReceiverInfo" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; font-family: 'Sarabun', 'Tahoma', sans-serif; min-height: 100px; box-sizing: border-box;">${receiverAddress || ''}</textarea>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div id="labelPreview" style="width: 101.6mm; height: 152.4mm; border: 2px solid #333; background: white; padding: 3mm; margin: 0 auto; display: inline-flex; flex-direction: column; font-family: 'Sarabun', 'Tahoma', sans-serif; box-sizing: border-box;">
                            <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 2mm; margin-bottom: 3mm;">
                                <h2 style="font-size: 24px; font-weight: bold; margin: 0; color: #000;">Chiangmai Freshmilk</h2>
                            </div>
                            
                            <div style="margin-bottom: 3mm; padding-bottom: 3mm; border-bottom: 1px dashed #999;">
                                <div style="font-weight: bold; font-size: 14px; margin-bottom: 2mm; color: #000;">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á (FROM):</div>
                                <div style="font-size: 12px; line-height: 1.4; color: #333; white-space: pre-line;">${defaultSender}</div>
                            </div>
                            
                            <div style="flex: 1; display: flex; flex-direction: column; margin-bottom: 3mm;">
                                <div style="font-weight: bold; font-size: 16px; margin-bottom: 2mm; color: #000; background: #f0f0f0; padding: 2mm; border-radius: 3px;">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (TO):</div>
                                <div id="modalReceiverDisplay" style="font-size: 14px; line-height: 1.6; color: #000; white-space: pre-line; flex: 1;">${displayReceiver}</div>
                            </div>
                            
                            <div style="margin-top: auto; padding-top: 2mm; border-top: 2px solid #333; text-align: center;">
                                <div style="margin-bottom: 2mm;">
                                    <img src="https://img5.pic.in.th/file/secure-sv1/dont.png" alt="Warning" style="width: 95mm; height: auto; max-width: 100%;" onerror="this.style.display='none'">
                                </div>
                                <div style="font-size: 10px; color: #666;">${timestamp}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="printShippingLabel()" style="flex: 1; background: #10b981; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; font-family: 'Sarabun', sans-serif;">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏â‡∏•‡∏≤‡∏Å</button>
                        <button onclick="closeShippingLabelModal()" style="flex: 1; background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; font-family: 'Sarabun', sans-serif;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Update receiver display when typing
            setTimeout(() => {
                const modalReceiverInfo = document.getElementById('modalReceiverInfo');
                if (modalReceiverInfo) {
                    modalReceiverInfo.addEventListener('input', function() {
                        let receiver = this.value.trim();
                        if (receiver && !receiver.startsWith('‡∏Ñ‡∏∏‡∏ì')) {
                            receiver = '‡∏Ñ‡∏∏‡∏ì ' + receiver;
                        }
                        const displayEl = document.getElementById('modalReceiverDisplay');
                        if (displayEl) {
                            displayEl.textContent = receiver || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö';
                        }
                    });
                }
            }, 100);
        }

        window.closeShippingLabelModal = function() {
            const modal = document.getElementById('shippingLabelModal');
            if (modal) {
                modal.remove();
            }
        }

        window.printShippingLabel = function() {
            const labelPreview = document.getElementById('labelPreview');
            if (!labelPreview) return;
            
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏±‡∏î‡∏™‡πà‡∏á - Chiangmai Freshmilk</title>
                    <style>
                        @page {
                            size: 4in 6in;
                            margin: 0;
                        }
                        body {
                            margin: 0;
                            padding: 0;
                            font-family: 'Sarabun', 'Tahoma', sans-serif;
                        }
                        .label {
                            width: 101.6mm;
                            height: 152.4mm;
                        }
                    </style>
                </head>
                <body>
                    <div class="label">${labelPreview.innerHTML}</div>
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                            }, 500);
                        }
                        window.onafterprint = function() {
                            window.close();
                        }
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Initialize with empty page
        renderPhotos();
    </script>
</body>
</html>