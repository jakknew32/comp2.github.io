<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d1117;
    --surface: #161b22;
    --surface2: #21262d;
    --border: #30363d;
    --accent: #58a6ff;
    --accent2: #3fb950;
    --warn: #d29922;
    --danger: #f85149;
    --text: #e6edf3;
    --text2: #8b949e;
    --text3: #6e7681;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Sarabun', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    font-size: 15px;
  }

  /* NAV */
  nav {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    display: flex;
    align-items: center;
    gap: 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .nav-brand {
    font-size: 18px;
    font-weight: 700;
    color: var(--accent);
    font-family: 'IBM Plex Mono', monospace;
    padding: 16px 24px 16px 0;
    border-right: 1px solid var(--border);
    margin-right: 8px;
    letter-spacing: -0.5px;
  }

  .nav-tabs { display: flex; gap: 0; }

  .nav-tab {
    padding: 18px 20px;
    cursor: pointer;
    color: var(--text2);
    font-size: 14px;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    user-select: none;
  }

  .nav-tab:hover { color: var(--text); background: rgba(255,255,255,0.03); }
  .nav-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

  /* MAIN */
  main { padding: 28px 32px; max-width: 1300px; margin: 0 auto; }

  /* PAGE */
  .page { display: none; animation: fadeIn 0.2s ease; }
  .page.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  /* STAT CARDS */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 28px;
  }

  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
  }

  .stat-label { font-size: 12px; color: var(--text3); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
  .stat-value { font-size: 28px; font-weight: 700; font-family: 'IBM Plex Mono', monospace; }
  .stat-value.blue { color: var(--accent); }
  .stat-value.green { color: var(--accent2); }
  .stat-value.warn { color: var(--warn); }
  .stat-value.red { color: var(--danger); }

  /* SECTION HEADER */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .section-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
  }

  /* BUTTONS */
  .btn {
    padding: 8px 16px;
    border-radius: 6px;
    border: 1px solid;
    cursor: pointer;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.15s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn-primary { background: var(--accent); border-color: var(--accent); color: #000; }
  .btn-primary:hover { background: #79b8ff; }
  .btn-success { background: var(--accent2); border-color: var(--accent2); color: #000; }
  .btn-success:hover { background: #56d364; }
  .btn-outline { background: transparent; border-color: var(--border); color: var(--text); }
  .btn-outline:hover { background: var(--surface2); }
  .btn-danger { background: transparent; border-color: var(--danger); color: var(--danger); }
  .btn-danger:hover { background: rgba(248,81,73,0.1); }
  .btn-sm { padding: 4px 10px; font-size: 13px; }

  /* TABLE */
  .table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
  }

  table { width: 100%; border-collapse: collapse; }

  thead tr { background: var(--surface2); border-bottom: 1px solid var(--border); }
  th {
    padding: 12px 16px;
    text-align: left;
    font-size: 12px;
    font-weight: 600;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  td {
    padding: 13px 16px;
    font-size: 14px;
    border-bottom: 1px solid rgba(48,54,61,0.5);
  }
  tr:last-child td { border-bottom: none; }
  tbody tr:hover { background: rgba(255,255,255,0.02); }

  .badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }
  .badge-green { background: rgba(63,185,80,0.15); color: var(--accent2); }
  .badge-warn { background: rgba(210,153,34,0.15); color: var(--warn); }
  .badge-red { background: rgba(248,81,73,0.15); color: var(--danger); }
  .badge-blue { background: rgba(88,166,255,0.15); color: var(--accent); }

  /* MODAL */
  .modal-bg {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 200;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }
  .modal-bg.show { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    width: 500px;
    max-width: 95vw;
    animation: modalIn 0.2s ease;
  }
  @keyframes modalIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .modal-title { font-size: 16px; font-weight: 600; }
  .modal-close {
    background: none;
    border: none;
    color: var(--text2);
    cursor: pointer;
    font-size: 20px;
    line-height: 1;
    padding: 2px;
  }
  .modal-close:hover { color: var(--text); }
  .modal-body { padding: 24px; }
  .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 8px; justify-content: flex-end; }

  /* FORM */
  .form-group { margin-bottom: 16px; }
  label { display: block; font-size: 13px; font-weight: 500; color: var(--text2); margin-bottom: 6px; }
  input, select, textarea {
    width: 100%;
    padding: 9px 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text);
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    transition: border-color 0.15s;
  }
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--accent);
  }
  select option { background: var(--surface2); }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  /* SEARCH */
  .search-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
  }
  .search-bar input { flex: 1; }

  /* LOW STOCK ALERT */
  .alert {
    background: rgba(210,153,34,0.08);
    border: 1px solid rgba(210,153,34,0.3);
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 20px;
    color: var(--warn);
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* PRINT STYLES */
  @media print {
    body { background: white; color: #000; font-size: 12px; }
    nav, .no-print { display: none !important; }
    main { padding: 0; max-width: 100%; }
    .print-page { display: block !important; }
    .page { display: block !important; }

    .print-report {
      padding: 20mm;
      max-width: 210mm;
      margin: 0 auto;
    }
    .report-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 12px; }
    .report-title { font-size: 20px; font-weight: 700; }
    .report-sub { font-size: 12px; color: #555; margin-top: 4px; }

    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; }
    th { background: #f0f0f0; font-weight: 700; text-transform: none; letter-spacing: 0; font-size: 12px; color: #000; }
    td { font-size: 11px; }
    .badge { background: none !important; color: #000 !important; }
    .table-wrap { border: none; border-radius: 0; }
    thead tr { background: #f0f0f0 !important; }
    .stat-value, .section-title { color: #000 !important; }
    .print-summary { margin-top: 20px; }
  }

  @page {
    size: A4;
    margin: 15mm;
  }
</style>
</head>
<body>

<nav>
  <div class="nav-brand">STOCK‚Ä¢SYS</div>
  <div class="nav-tabs">
    <div class="nav-tab active" onclick="showPage('dashboard')">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</div>
    <div class="nav-tab" onclick="showPage('products')">üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
    <div class="nav-tab" onclick="showPage('dispatch')">üöö ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
    <div class="nav-tab" onclick="showPage('report')">üìÑ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
  </div>
</nav>

<main>

  <!-- ===== DASHBOARD ===== -->
  <div id="page-dashboard" class="page active">
    <div class="stats-grid" id="statsGrid"></div>
    <div id="lowStockAlert"></div>
    <div class="section-header">
      <div class="section-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
            <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          </tr>
        </thead>
        <tbody id="dashboardTable"></tbody>
      </table>
    </div>
  </div>

  <!-- ===== PRODUCTS ===== -->
  <div id="page-products" class="page">
    <div class="section-header">
      <div class="section-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <button class="btn btn-primary" onclick="openAddProduct()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <div class="search-bar no-print">
      <input type="text" id="searchProduct" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." oninput="renderProducts()">
      <select id="filterCategory" onchange="renderProducts()">
        <option value="">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      </select>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
            <th>‡∏™‡∏ï‡πä‡∏≠‡∏Å</th><th>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="productsTable"></tbody>
      </table>
    </div>
  </div>

  <!-- ===== DISPATCH ===== -->
  <div id="page-dispatch" class="page">
    <div class="section-header">
      <div class="section-title">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <button class="btn btn-success" onclick="openDispatch()">+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</button>
    </div>
    <div class="search-bar no-print">
      <input type="text" id="searchDispatch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="renderDispatch()">
      <select id="filterDest" onchange="renderDispatch()">
        <option value="">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      </select>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á/‡πÅ‡∏ú‡∏ô‡∏Å</th><th>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="dispatchTable"></tbody>
      </table>
    </div>
  </div>

  <!-- ===== REPORT ===== -->
  <div id="page-report" class="page">
    <div class="section-header no-print">
      <div class="section-title">‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</button>
      </div>
    </div>
    <div class="search-bar no-print" style="flex-wrap:wrap;">
      <select id="reportType" onchange="renderReport()" style="width:200px;">
        <option value="stock">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
        <option value="dispatch">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
        <option value="lowstock">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</option>
      </select>
      <input type="date" id="rDateFrom" onchange="renderReport()" style="width:160px;">
      <span style="align-self:center;color:var(--text2)">‡∏ñ‡∏∂‡∏á</span>
      <input type="date" id="rDateTo" onchange="renderReport()" style="width:160px;">
      <select id="rProduct" onchange="renderReport()" style="width:200px;">
        <option value="">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      </select>
      <select id="rDest" onchange="renderReport()" style="width:200px;">
        <option value="">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      </select>
    </div>
    <div id="reportOutput"></div>
  </div>

</main>

<!-- ===== MODAL: ADD/EDIT PRODUCT ===== -->
<div class="modal-bg" id="modalProduct">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalProductTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</div>
      <button class="modal-close" onclick="closeModal('modalProduct')">‚úï</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="pId">
      <div class="form-row">
        <div class="form-group">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
          <input type="text" id="pCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô PRD001">
        </div>
        <div class="form-group">
          <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label>
          <input type="text" id="pCategory" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô" list="catList">
          <datalist id="catList"></datalist>
        </div>
      </div>
      <div class="form-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
        <input type="text" id="pName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å *</label>
          <input type="number" id="pStock" min="0" placeholder="0">
        </div>
        <div class="form-group">
          <label>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)</label>
          <input type="number" id="pMinStock" min="0" placeholder="10">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
          <input type="text" id="pUnit" placeholder="‡∏ä‡∏¥‡πâ‡∏ô / ‡∏Å‡∏•‡πà‡∏≠‡∏á / ‡πÅ‡∏û‡πá‡∏Ñ">
        </div>
        <div class="form-group">
          <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
          <input type="number" id="pCost" min="0" step="0.01" placeholder="0.00">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modalProduct')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn btn-primary" onclick="saveProduct()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: DISPATCH ===== -->
<div class="modal-bg" id="modalDispatch">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <button class="modal-close" onclick="closeModal('modalDispatch')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
        <select id="dProduct"></select>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label>
          <input type="number" id="dQty" min="1" placeholder="0">
        </div>
        <div class="form-group">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ *</label>
          <input type="date" id="dDate">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á / ‡πÅ‡∏ú‡∏ô‡∏Å *</label>
          <input type="text" id="dDest" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" list="destList">
          <datalist id="destList"></datalist>
        </div>
        <div class="form-group">
          <label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</label>
          <input type="text" id="dReceiver" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö">
        </div>
      </div>
      <div class="form-group">
        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <textarea id="dNote" rows="2" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modalDispatch')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn btn-success" onclick="saveDispatch()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</button>
    </div>
  </div>
</div>

<script>
// ===== DATA =====
let products = JSON.parse(localStorage.getItem('products') || '[]');
let dispatches = JSON.parse(localStorage.getItem('dispatches') || '[]');

// Seed demo data
if (products.length === 0) {
  products = [
    { id: 1, code: 'STK001', name: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 80g', category: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', stock: 150, minStock: 20, unit: '‡∏£‡∏µ‡∏°', cost: 120 },
    { id: 2, code: 'STK002', name: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏•‡∏π‡∏Å‡∏•‡∏∑‡πà‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô', category: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', stock: 85, minStock: 30, unit: '‡∏î‡πâ‡∏≤‡∏°', cost: 8 },
    { id: 3, code: 'STK003', name: '‡πÅ‡∏ü‡πâ‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ A4', category: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', stock: 12, minStock: 15, unit: '‡∏≠‡∏±‡∏ô', cost: 35 },
    { id: 4, code: 'STK004', name: '‡∏Å‡∏≤‡∏ß‡∏•‡∏≤‡πÄ‡∏ó‡πá‡∏Å‡∏ã‡πå', category: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', stock: 30, minStock: 10, unit: '‡∏Ç‡∏ß‡∏î', cost: 25 },
    { id: 5, code: 'STK005', name: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÇ‡∏ô‡πâ‡∏ï Post-it', category: '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', stock: 8, minStock: 10, unit: '‡πÅ‡∏û‡πá‡∏Ñ', cost: 45 },
  ];
  dispatches = [
    { id: 1, productId: 1, qty: 10, date: '2025-01-15', dest: '‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', receiver: '‡∏™‡∏°‡∏®‡∏£‡∏µ ‡πÉ‡∏à‡∏î‡∏µ', note: '' },
    { id: 2, productId: 2, qty: 20, date: '2025-01-16', dest: '‡∏ù‡πà‡∏≤‡∏¢ IT', receiver: '‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô', note: '‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ' },
    { id: 3, productId: 1, qty: 5, date: '2025-01-18', dest: '‡∏ù‡πà‡∏≤‡∏¢ HR', receiver: '‡∏°‡∏≤‡∏•‡∏µ ‡∏™‡∏∏‡∏î‡∏™‡∏ß‡∏¢', note: '' },
    { id: 4, productId: 3, qty: 3, date: '2025-01-20', dest: '‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢', receiver: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏î‡∏µ‡πÉ‡∏à', note: '' },
  ];
  save();
}

function save() {
  localStorage.setItem('products', JSON.stringify(products));
  localStorage.setItem('dispatches', JSON.stringify(dispatches));
}

let nextPid = products.length ? Math.max(...products.map(p => p.id)) + 1 : 1;
let nextDid = dispatches.length ? Math.max(...dispatches.map(d => d.id)) + 1 : 1;

// ===== NAVIGATION =====
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach(t => {
    if (t.textContent.toLowerCase().includes({ dashboard: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°', products: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', dispatch: '‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢', report: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô' }[page].slice(0, 3))) {
      t.classList.add('active');
    }
  });
  if (page === 'dashboard') renderDashboard();
  if (page === 'products') renderProducts();
  if (page === 'dispatch') renderDispatch();
  if (page === 'report') { populateReportFilters(); renderReport(); }
}

// Fix nav tab click
document.querySelectorAll('.nav-tab').forEach((t, i) => {
  const pages = ['dashboard','products','dispatch','report'];
  t.onclick = () => {
    document.querySelectorAll('.nav-tab').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    showPage(pages[i]);
  };
});

// ===== DASHBOARD =====
function renderDashboard() {
  const totalItems = products.length;
  const totalStock = products.reduce((a, p) => a + p.stock, 0);
  const lowStock = products.filter(p => p.stock <= p.minStock).length;
  const totalValue = products.reduce((a, p) => a + p.stock * p.cost, 0);

  document.getElementById('statsGrid').innerHTML = `
    <div class="stat-card"><div class="stat-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div><div class="stat-value blue">${totalItems}</div></div>
    <div class="stat-card"><div class="stat-label">‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏£‡∏ß‡∏°</div><div class="stat-value green">${totalStock.toLocaleString()}</div></div>
    <div class="stat-card"><div class="stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div><div class="stat-value ${lowStock > 0 ? 'warn' : 'green'}">${lowStock}</div></div>
    <div class="stat-card"><div class="stat-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å (‡∏ö‡∏≤‡∏ó)</div><div class="stat-value blue">${totalValue.toLocaleString('th-TH', {minimumFractionDigits:2})}</div></div>
  `;

  const low = products.filter(p => p.stock <= p.minStock);
  document.getElementById('lowStockAlert').innerHTML = low.length
    ? `<div class="alert">‚ö†Ô∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${low.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${low.map(p => p.name).join(', ')}</div>`
    : '';

  document.getElementById('dashboardTable').innerHTML = products.map(p => {
    const status = p.stock === 0 ? '<span class="badge badge-red">‡∏´‡∏°‡∏î</span>'
      : p.stock <= p.minStock ? '<span class="badge badge-warn">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</span>'
      : '<span class="badge badge-green">‡∏õ‡∏Å‡∏ï‡∏¥</span>';
    return `<tr>
      <td><code style="color:var(--accent);font-family:'IBM Plex Mono',monospace;font-size:12px">${p.code}</code></td>
      <td>${p.name}</td><td>${p.category}</td>
      <td style="font-weight:600">${p.stock.toLocaleString()}</td>
      <td style="color:var(--text2)">${p.unit}</td>
      <td style="font-family:'IBM Plex Mono',monospace">${p.cost.toLocaleString('th-TH', {minimumFractionDigits:2})}</td>
      <td>${status}</td>
    </tr>`;
  }).join('');
}

// ===== PRODUCTS =====
function renderProducts() {
  const q = (document.getElementById('searchProduct')?.value || '').toLowerCase();
  const cat = document.getElementById('filterCategory')?.value || '';

  const cats = [...new Set(products.map(p => p.category))];
  const sel = document.getElementById('filterCategory');
  if (sel) {
    const cur = sel.value;
    sel.innerHTML = '<option value="">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>' + cats.map(c => `<option value="${c}" ${c===cur?'selected':''}>${c}</option>`).join('');
  }

  const catList = document.getElementById('catList');
  if (catList) catList.innerHTML = cats.map(c => `<option value="${c}">`).join('');

  const filtered = products.filter(p =>
    (p.name.toLowerCase().includes(q) || p.code.toLowerCase().includes(q)) &&
    (!cat || p.category === cat)
  );

  document.getElementById('productsTable').innerHTML = filtered.map(p => {
    const stockClass = p.stock === 0 ? 'red' : p.stock <= p.minStock ? 'warn' : 'green';
    return `<tr>
      <td><code style="color:var(--accent);font-family:'IBM Plex Mono',monospace;font-size:12px">${p.code}</code></td>
      <td><strong>${p.name}</strong></td>
      <td><span class="badge badge-blue">${p.category}</span></td>
      <td style="color:var(--${stockClass});font-weight:700;font-family:'IBM Plex Mono',monospace">${p.stock}</td>
      <td style="color:var(--text2)">${p.minStock}</td>
      <td style="color:var(--text2)">${p.unit}</td>
      <td style="font-family:'IBM Plex Mono',monospace">${p.cost.toLocaleString('th-TH',{minimumFractionDigits:2})}</td>
      <td style="display:flex;gap:6px;">
        <button class="btn btn-outline btn-sm" onclick="openEditProduct(${p.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProduct(${p.id})">üóëÔ∏è</button>
      </td>
    </tr>`;
  }).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--text3);padding:32px">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</td></tr>';
}

// ===== PRODUCT MODAL =====
function openAddProduct() {
  document.getElementById('modalProductTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà';
  document.getElementById('pId').value = '';
  ['pCode','pName','pCategory','pUnit','pNote'].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
  document.getElementById('pStock').value = '';
  document.getElementById('pMinStock').value = '';
  document.getElementById('pCost').value = '';
  const cats = [...new Set(products.map(p => p.category))];
  document.getElementById('catList').innerHTML = cats.map(c => `<option value="${c}">`).join('');
  openModal('modalProduct');
}

function openEditProduct(id) {
  const p = products.find(x => x.id === id);
  if (!p) return;
  document.getElementById('modalProductTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
  document.getElementById('pId').value = p.id;
  document.getElementById('pCode').value = p.code;
  document.getElementById('pName').value = p.name;
  document.getElementById('pCategory').value = p.category;
  document.getElementById('pStock').value = p.stock;
  document.getElementById('pMinStock').value = p.minStock;
  document.getElementById('pUnit').value = p.unit;
  document.getElementById('pCost').value = p.cost;
  openModal('modalProduct');
}

function saveProduct() {
  const id = document.getElementById('pId').value;
  const code = document.getElementById('pCode').value.trim();
  const name = document.getElementById('pName').value.trim();
  const category = document.getElementById('pCategory').value.trim();
  const stock = parseInt(document.getElementById('pStock').value) || 0;
  const minStock = parseInt(document.getElementById('pMinStock').value) || 0;
  const unit = document.getElementById('pUnit').value.trim();
  const cost = parseFloat(document.getElementById('pCost').value) || 0;

  if (!code || !name || !category) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô'); return; }

  if (id) {
    const p = products.find(x => x.id == id);
    Object.assign(p, { code, name, category, stock, minStock, unit, cost });
  } else {
    products.push({ id: nextPid++, code, name, category, stock, minStock, unit, cost });
  }
  save();
  closeModal('modalProduct');
  renderProducts();
}

function deleteProduct(id) {
  if (!confirm('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?')) return;
  products = products.filter(p => p.id !== id);
  save();
  renderProducts();
}

// ===== DISPATCH =====
function renderDispatch() {
  const q = (document.getElementById('searchDispatch')?.value || '').toLowerCase();
  const dest = document.getElementById('filterDest')?.value || '';

  const dests = [...new Set(dispatches.map(d => d.dest))];
  const sel = document.getElementById('filterDest');
  if (sel) {
    const cur = sel.value;
    sel.innerHTML = '<option value="">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>' + dests.map(d => `<option value="${d}" ${d===cur?'selected':''}>${d}</option>`).join('');
  }

  const destList = document.getElementById('destList');
  if (destList) destList.innerHTML = dests.map(d => `<option value="${d}">`).join('');

  const filtered = dispatches.filter(d => {
    const p = products.find(x => x.id === d.productId);
    const pname = p ? p.name.toLowerCase() : '';
    return (pname.includes(q) || d.dest.toLowerCase().includes(q) || (d.receiver || '').toLowerCase().includes(q))
      && (!dest || d.dest === dest);
  }).sort((a, b) => b.date.localeCompare(a.date));

  document.getElementById('dispatchTable').innerHTML = filtered.map(d => {
    const p = products.find(x => x.id === d.productId);
    return `<tr>
      <td style="font-family:'IBM Plex Mono',monospace;font-size:12px">${d.date}</td>
      <td><code style="color:var(--accent);font-family:'IBM Plex Mono',monospace;font-size:12px">${p ? p.code : '-'}</code></td>
      <td>${p ? p.name : '-'}</td>
      <td style="font-weight:700;color:var(--danger)">${d.qty}</td>
      <td style="color:var(--text2)">${p ? p.unit : '-'}</td>
      <td><span class="badge badge-blue">${d.dest}</span></td>
      <td>${d.receiver || '-'}</td>
      <td style="color:var(--text2)">${d.note || '-'}</td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteDispatch(${d.id})">üóëÔ∏è</button></td>
    </tr>`;
  }).join('') || '<tr><td colspan="9" style="text-align:center;color:var(--text3);padding:32px">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>';
}

function openDispatch() {
  const sel = document.getElementById('dProduct');
  sel.innerHTML = products.map(p => `<option value="${p.id}">${p.code} - ${p.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${p.stock} ${p.unit})</option>`).join('');
  document.getElementById('dDate').value = new Date().toISOString().split('T')[0];
  document.getElementById('dQty').value = '';
  document.getElementById('dDest').value = '';
  document.getElementById('dReceiver').value = '';
  document.getElementById('dNote').value = '';
  const dests = [...new Set(dispatches.map(d => d.dest))];
  document.getElementById('destList').innerHTML = dests.map(d => `<option value="${d}">`).join('');
  openModal('modalDispatch');
}

function saveDispatch() {
  const productId = parseInt(document.getElementById('dProduct').value);
  const qty = parseInt(document.getElementById('dQty').value) || 0;
  const date = document.getElementById('dDate').value;
  const dest = document.getElementById('dDest').value.trim();
  const receiver = document.getElementById('dReceiver').value.trim();
  const note = document.getElementById('dNote').value.trim();

  if (!productId || !qty || !date || !dest) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô'); return; }

  const p = products.find(x => x.id === productId);
  if (!p) return;
  if (qty > p.stock) { alert(`‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${p.stock} ${p.unit}`); return; }

  p.stock -= qty;
  dispatches.push({ id: nextDid++, productId, qty, date, dest, receiver, note });
  save();
  closeModal('modalDispatch');
  renderDispatch();
  if (document.getElementById('page-dashboard').classList.contains('active')) renderDashboard();
}

function deleteDispatch(id) {
  if (!confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ? ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏Å‡∏•‡∏±‡∏ö')) return;
  const d = dispatches.find(x => x.id === id);
  if (d) {
    const p = products.find(x => x.id === d.productId);
    if (p) p.stock += d.qty;
  }
  dispatches = dispatches.filter(x => x.id !== id);
  save();
  renderDispatch();
}

// ===== REPORT =====
function populateReportFilters() {
  const rpSel = document.getElementById('rProduct');
  rpSel.innerHTML = '<option value="">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>' + products.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

  const dests = [...new Set(dispatches.map(d => d.dest))];
  const rdSel = document.getElementById('rDest');
  rdSel.innerHTML = '<option value="">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>' + dests.map(d => `<option value="${d}">${d}</option>`).join('');
}

function renderReport() {
  const type = document.getElementById('reportType').value;
  const dateFrom = document.getElementById('rDateFrom').value;
  const dateTo = document.getElementById('rDateTo').value;
  const filterProduct = document.getElementById('rProduct').value;
  const filterDest = document.getElementById('rDest').value;
  const now = new Date().toLocaleDateString('th-TH', {year:'numeric',month:'long',day:'numeric'});

  let html = `<div class="print-report">
    <div class="report-header">
      <div class="report-title">`;

  if (type === 'stock') {
    const data = products.filter(p => !filterProduct || p.id == filterProduct);
    const total = data.reduce((a, p) => a + p.stock, 0);
    const totalVal = data.reduce((a, p) => a + p.stock * p.cost, 0);

    html += `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <div class="report-sub">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${now}</div>
    </div>
    <table>
      <thead><tr>
        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
        <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</th><th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      </tr></thead>
      <tbody>
      ${data.map((p, i) => {
        const status = p.stock === 0 ? '‡∏´‡∏°‡∏î' : p.stock <= p.minStock ? '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î' : '‡∏õ‡∏Å‡∏ï‡∏¥';
        return `<tr>
          <td style="text-align:center">${i+1}</td>
          <td>${p.code}</td><td>${p.name}</td><td>${p.category}</td>
          <td style="text-align:right;font-weight:700">${p.stock.toLocaleString()}</td>
          <td style="text-align:right">${p.minStock.toLocaleString()}</td>
          <td>${p.unit}</td>
          <td style="text-align:right">${p.cost.toLocaleString('th-TH',{minimumFractionDigits:2})}</td>
          <td style="text-align:right">${(p.stock*p.cost).toLocaleString('th-TH',{minimumFractionDigits:2})}</td>
          <td style="text-align:center">${status}</td>
        </tr>`;
      }).join('')}
      </tbody>
    </table>
    <div class="print-summary" style="margin-top:16px;border-top:2px solid var(--border);padding-top:12px;">
      <table style="width:auto;margin-left:auto;">
        <tr><td style="padding:4px 12px;font-weight:600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</td><td style="padding:4px 12px;text-align:right">${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>
        <tr><td style="padding:4px 12px;font-weight:600">‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏£‡∏ß‡∏°:</td><td style="padding:4px 12px;text-align:right">${total.toLocaleString()} ‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</td></tr>
        <tr style="background:rgba(88,166,255,0.1)"><td style="padding:4px 12px;font-weight:700">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°:</td><td style="padding:4px 12px;text-align:right;font-weight:700">${totalVal.toLocaleString('th-TH',{minimumFractionDigits:2})} ‡∏ö‡∏≤‡∏ó</td></tr>
      </table>
    </div>`;

  } else if (type === 'dispatch') {
    let data = dispatches.filter(d => {
      if (filterProduct && d.productId != filterProduct) return false;
      if (filterDest && d.dest !== filterDest) return false;
      if (dateFrom && d.date < dateFrom) return false;
      if (dateTo && d.date > dateTo) return false;
      return true;
    }).sort((a, b) => b.date.localeCompare(a.date));

    const totalQty = data.reduce((a, d) => a + d.qty, 0);

    html += `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
      <div class="report-sub">
        ${dateFrom || dateTo ? `‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateFrom || '-'} ‡∏ñ‡∏∂‡∏á ${dateTo || '-'} &nbsp;|&nbsp;` : ''}
        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${now}
      </div>
    </div>
    <table>
      <thead><tr>
        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á/‡πÅ‡∏ú‡∏ô‡∏Å</th><th>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
      </tr></thead>
      <tbody>
      ${data.map((d, i) => {
        const p = products.find(x => x.id === d.productId);
        return `<tr>
          <td style="text-align:center">${i+1}</td>
          <td>${d.date}</td>
          <td>${p ? p.code : '-'}</td><td>${p ? p.name : '-'}</td>
          <td style="text-align:right;font-weight:700">${d.qty.toLocaleString()}</td>
          <td>${p ? p.unit : '-'}</td>
          <td>${d.dest}</td><td>${d.receiver || '-'}</td><td>${d.note || '-'}</td>
        </tr>`;
      }).join('')}
      </tbody>
    </table>
    <div class="print-summary" style="margin-top:16px;border-top:2px solid var(--border);padding-top:12px;">
      <table style="width:auto;margin-left:auto;">
        <tr><td style="padding:4px 12px;font-weight:600">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</td><td style="padding:4px 12px;text-align:right">${data.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</td></tr>
        <tr style="background:rgba(88,166,255,0.1)"><td style="padding:4px 12px;font-weight:700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡∏£‡∏ß‡∏°:</td><td style="padding:4px 12px;text-align:right;font-weight:700">${totalQty.toLocaleString()} ‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</td></tr>
      </table>
    </div>`;

  } else if (type === 'lowstock') {
    const data = products.filter(p => p.stock <= p.minStock);
    html += `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥ / ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
      <div class="report-sub">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${now}</div>
    </div>
    ${data.length === 0 ? '<p style="text-align:center;padding:32px;color:#888">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥</p>' : `
    <table>
      <thead><tr>
        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
        <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏Ç‡∏≤‡∏î</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      </tr></thead>
      <tbody>
      ${data.map((p, i) => {
        const deficit = Math.max(0, p.minStock - p.stock);
        const status = p.stock === 0 ? '‡∏´‡∏°‡∏î' : '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î';
        return `<tr>
          <td style="text-align:center">${i+1}</td>
          <td>${p.code}</td><td>${p.name}</td><td>${p.category}</td>
          <td style="text-align:right;font-weight:700;color:#c0392b">${p.stock}</td>
          <td style="text-align:right">${p.minStock}</td>
          <td>${p.unit}</td>
          <td style="text-align:right;font-weight:700">${deficit}</td>
          <td style="text-align:center;font-weight:700">${status}</td>
        </tr>`;
      }).join('')}
      </tbody>
    </table>`}`;
  }

  html += `</div>`;
  document.getElementById('reportOutput').innerHTML = html;
}

// ===== MODAL HELPERS =====
function openModal(id) { document.getElementById(id).classList.add('show'); }
function closeModal(id) { document.getElementById(id).classList.remove('show'); }

document.querySelectorAll('.modal-bg').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) m.classList.remove('show'); });
});

// Init
renderDashboard();
</script>
</body>
</html>
